(function(a){a.fn.scaleImage=function(b){function e(a){var b=new Image;b.src=a.attr("src");return{width:b.width,height:b.height}}function d(a,b){var d=e(a),f=d.width,g=d.height,h=b.width(),i=b.height(),j=parseInt(a.css("borderLeftWidth"),10)+parseInt(a.css("borderRightWidth"),10),k=parseInt(a.css("borderTopWidth"),10)+parseInt(a.css("borderBottomWidth"),10),l,m,n,o,p;j=isNaN(j)?0:j;k=isNaN(k)?0:k;l=h/f;m=i/g;n=l>m?l:m;o=parseInt(f*n,10)-j;p=parseInt(g*n,10)-k;a.css({width:o,height:p}).attr({width:o,height:p});a.css("margin-left",Math.floor((h-o)/2));a.css("margin-top",Math.floor((i-p)/2));b.parents("article").addClass("preview")}var c=a.extend({parent:false,scale:"fill",center:true,fade:0},b);return this.each(function(){var b=a(this);var e=c.parent?b.parents(c.parent):b.parent();e.css({overflow:"hidden"});if(e.length>0){b.removeAttr("height").removeAttr("width");if(this.complete){d(b,e)}else{b.load(function(){d(b,e)})}}})}})(jQuery)